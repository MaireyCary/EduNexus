var g=(t,e,r)=>new Promise((m,l)=>{var s=h=>{try{n(r.next(h))}catch(a){l(a)}},i=h=>{try{n(r.throw(h))}catch(a){l(a)}},n=h=>h.done?m(h.value):Promise.resolve(h.value).then(s,i);n((r=r.apply(t,e)).next())});import{_ as v,k as T,r as C,c as d,o as c,e as o,b as y,h as D,F as p,l as x,g as B,f as P,m as b,t as f,n as L,p as E}from"./index-oHwlPX18.js";const M={components:{ArrowDown:T},data(){return{examData:[],dates:[],selectedClass:"",filteredClassList:[],defaultClassTable:[{timePeriod:"上午8:40 - 10:10"},{timePeriod:"上午10:20 - 11:50"},{timePeriod:"下午14:30 - 16:00"},{timePeriod:"下午16:15 - 17:45"},{timePeriod:"晚上19:00 - 20:30"}],placeholderDateCount:9,errorMessage:"",uploadFile:null,uploadSuccess:!1,uploadError:"",generateSuccess:!1,generateError:""}},created(){this.fetchData()},methods:{fetchData(){E.get("http://localhost:5000/exam_scheduling/get/exam").then(t=>{const e=t.data.exam_data;e==="考试数据尚未录入"?this.errorMessage="考试数据尚未录入":e&&Array.isArray(e.classes)?(this.examData=e.classes,this.dates=this.extractDates(e.classes),this.errorMessage=""):e&&Array.isArray(e.classes)?(this.examData=e.classes,this.dates=this.extractDates(e.classes),this.errorMessage=""):(this.errorMessage="后端返回的数据格式不正确",console.error("数据格式不正确:",t.data))}).catch(t=>{this.errorMessage=`获取数据失败: ${t.message}`,console.error("获取数据失败:",t)})},extractDates(t){const e=new Set;return t.forEach(r=>{r.exams.forEach(m=>{const l=m.time.split(" ")[0];e.add(l)})}),Array.from(e).sort()},getDates(){return this.dates.length>0?this.dates:Array.from({length:this.placeholderDateCount},(t,e)=>`占位日期 ${e+1}`)},getAllClasses(){const t=this.examData.map(e=>e.classId);return this.filteredClassList=t,t},handleClassChange(t){this.selectedClass=t},getExamDataByTimePeriod(t,e){const m={"上午8:40 - 10:10":"1-2节","上午10:20 - 11:50":"3-4节","下午14:30 - 16:00":"5-6节","下午16:15 - 17:45":"7-8节","晚上19:00 - 20:30":"9-10节"}[t];let l=this.examData;this.selectedClass&&(l=this.examData.filter(i=>i.classId===this.selectedClass));const s=l.find(i=>i.exams.some(n=>n.time.includes(e)&&n.time.includes(m)));if(s){const i=s.exams.find(n=>n.time.includes(e)&&n.time.includes(m));return{classId:s.classId,color:this.getRandomColor(),detail:{classroom:i.classroom,examName:i.examName,teachers:i.teachers}}}return null},getRandomColor(){const t=["lightcoral","lightgreen","lightblue"];return t[Math.floor(Math.random()*t.length)]},uploadCourses(){return g(this,null,function*(){const t=document.createElement("input");t.type="file",t.accept=".xlsx,.xls",t.onchange=e=>g(this,null,function*(){var m,l;const r=e.target.files[0];if(r){const s=new FormData;s.append("file",r);try{yield E.post("http://localhost:5000/exam_scheduling/upload/courses",s,{headers:{"Content-Type":"multipart/form-data"}}),this.uploadSuccess=!0,this.uploadError="",this.$message.success("课程信息发布成功"),this.fetchData(),window.location.reload()}catch(i){this.uploadError=((l=(m=i.response)==null?void 0:m.data)==null?void 0:l.error)||"上传失败",this.$message.error(this.uploadError)}}}),t.click()})},downloadExamScheduleTemplate(){return g(this,null,function*(){try{const t=yield E.get("http://localhost:5000/exam_scheduling/download/exam_template",{responseType:"blob"}),e=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a");r.href=URL.createObjectURL(e),r.download="考试安排样表.xlsx",r.click(),URL.revokeObjectURL(r.href),this.$message.success("考试安排样表下载成功")}catch(t){console.error("下载考试安排样表失败:",t),this.$message.error("下载考试安排样表失败，请重试")}})},filterClass(t){t?this.filteredClassList=this.getAllClasses().filter(e=>e.toLowerCase().includes(t.toLowerCase())):this.filteredClassList=this.getAllClasses()}}},w={class:"top-container"},A={class:"filter-container"},S={class:"button-group"},N={class:"scroll-container"},V={id:"app"},R={class:"table-container"},U={class:"class-table"},F={class:"examtime"},I={key:0,class:"detail-box"},j={class:"course-location"},O={class:"course-name"},z={class:"exam-method"},G={class:"course-title"},H={key:0,class:"error-message"};function J(t,e,r,m,l,s){const i=C("el-option"),n=C("el-select"),h=C("el-button");return c(),d("div",null,[o("div",w,[o("div",A,[y(n,{modelValue:l.selectedClass,"onUpdate:modelValue":e[0]||(e[0]=a=>l.selectedClass=a),placeholder:"请选择或搜索班级",clearable:"",onChange:s.handleClassChange,filterable:"","filter-method":s.filterClass},{default:D(()=>[(c(!0),d(p,null,x(l.filteredClassList,a=>(c(),B(i,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","filter-method"])]),o("div",S,[y(h,{type:"primary",onClick:s.downloadExamScheduleTemplate},{default:D(()=>e[1]||(e[1]=[P("下载考试安排样表")])),_:1},8,["onClick"]),y(h,{type:"primary",onClick:s.uploadCourses},{default:D(()=>e[2]||(e[2]=[P("上传课程信息")])),_:1},8,["onClick"])])]),o("div",N,[o("div",V,[o("div",R,[o("table",U,[o("thead",null,[o("tr",null,[e[3]||(e[3]=o("th",{class:"slash-cell"},null,-1)),(c(!0),d(p,null,x(s.getDates(),(a,_)=>(c(),d("th",{key:_},f(a==="占位日期"?"":a),1))),128))])]),o("tbody",null,[(c(!0),d(p,null,x(l.defaultClassTable,(a,_)=>(c(),d("tr",{key:_},[o("td",F,f(a.timePeriod),1),(c(!0),d(p,null,x(s.getDates(),(u,k)=>(c(),d("td",{key:k,class:"examtable"},[s.getExamDataByTimePeriod(a.timePeriod,u)?(c(),d("div",{key:0,style:L({backgroundColor:s.getExamDataByTimePeriod(a.timePeriod,u).color}),class:"examcolor"},[s.getExamDataByTimePeriod(a.timePeriod,u).detail?(c(),d("div",I,[o("div",j,f(s.getExamDataByTimePeriod(a.timePeriod,u).detail.classroom),1),o("div",O,f(s.getExamDataByTimePeriod(a.timePeriod,u).detail.examName),1),o("div",z," 监考教师："+f(s.getExamDataByTimePeriod(a.timePeriod,u).detail.teachers.join("、")),1)])):b("",!0),o("div",G,f(s.getExamDataByTimePeriod(a.timePeriod,u).classId),1)],4)):b("",!0)]))),128))]))),128))])])]),l.errorMessage?(c(),d("div",H,f(l.errorMessage),1)):b("",!0)])])])}const W=v(M,[["render",J]]);export{W as default};
